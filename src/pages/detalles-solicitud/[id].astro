---
/**
*Author: Hector Julian Zarate Ramirez
*
*Description: This script is used to create a page that shows the details of a request, based on the id passed in the URL.
*
**/
import MainLayout from "@layouts/MainLayout.astro";
import RequestDetail from "@components/RequestDetail.astro";
import type { UserRole } from "@type/roles";

export const prerender = false;
import { getCookie } from "@data/cookies";
import { roleLabels } from "@config/role-labels";

const role: UserRole = getCookie("role") as UserRole;
const userName = getCookie("username");
const buttonLabel = roleLabels[role];

// FETCH API DATA
import { apiRequest } from "@utils/apiClient";

export async function getStaticPaths() {
  const allRequests = await apiRequest(`/applicant/get-user-requests/${getCookie("id")}`);
  return allRequests.map((req: any) => ({
    params: { id: req.request_id.toString() },
  }));
}
const { id } = Astro.params;
const request = await apiRequest(`/applicant/get-user-request/${id}`);

if (!request) {
  throw new Error(`No request found with ID ${id}`);
}
---

<MainLayout title={`Detalle #${request.request_id}`} data={{ userName, buttonLabel, role }} >
  <RequestDetail request={request} />
</MainLayout>