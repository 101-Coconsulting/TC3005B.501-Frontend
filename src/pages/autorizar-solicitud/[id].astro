---
/**
 * Author: Julia Maria Stephanie Duenkelsbuehler Castillo Y Nicole Davila
 * 
 * Description: This Astro page renders an application approval screen.
 * It includes sections for travel details and buttons for authorization and rejection.
 */


import MainLayout from "@layouts/MainLayout.astro";
import RequestApproval from "@components/RequestApproval.astro";
import type { UserRole } from "@type/roles";

import { getCookie } from "@data/cookies";
import { roleLabels } from "@config/role-labels";
import { apiRequest } from '@utils/apiClient';

const role: UserRole = getCookie("role") as UserRole;
const userName = getCookie("username");
const buttonLabel = roleLabels[role];

export async function getStaticPaths() {
  const dept = getCookie("dept");
  const allRequests = await apiRequest(`/user/get-travel-requests/${dept}/1`); ;
  return allRequests.map((req: any) => ({
    params: { id: req.request_id.toString() },
  }));
}
const { id } = Astro.params;
const request = await apiRequest(`/user/get-travel-request/${id}`); 

---

<MainLayout title={`Solicitud #${request.request_id}`} data={{ userName, buttonLabel, role }} >
  <RequestApproval request={request} />
</MainLayout>