---
/**
 * Author: Julia Maria Stephanie Duenkelsbuehler Castillo Y Nicole Davila
 * 
 * Description: Page to edit a travel request using mock data.
 * 
 **/
export const prerender = false;

import MainLayout from "@layouts/MainLayout.astro";
import TextHeader from "@components/TextHeader.astro";
import RequestEdit from "@components/RequestEditList.astro";
import { getCookie } from "@data/cookies";
import { roleLabels } from "@config/role-labels";
import type { UserRole } from "@type/roles";
import { apiRequest } from "@utils/apiClient";

const { id } = Astro.params;

if (!id) {
  throw new Error("No se proporcionó ID de solicitud.");
}

const role: UserRole = getCookie("role") as UserRole;
const userName = getCookie("username");
const buttonLabel = roleLabels[role];
const user_id = getCookie("id");
const requests = await apiRequest(`/applicant/get-user-requests/${user_id}`);
const request = requests.find((r: any) => String(r.request_id) === String(id));

if (!request) {
  throw new Error(`No se encontró la solicitud con ID: ${id}`);
}

if (request.status !== "Abierto") {
  throw new Error("Solo se pueden editar solicitudes con estado 'Abierto'.");
}

---
<MainLayout title={`Editar Solicitud #${id}`} data={{ userName, role, buttonLabel }}>
  <TextHeader
    title={`EDITAR SOLICITUD #${id}`}
    subtitle="Modifica los datos necesarios y vuelve a enviar"
  />
  <RequestEdit request={request} />
</MainLayout>