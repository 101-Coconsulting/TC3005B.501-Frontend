---
/**
 * Author: Eduardo Porto Morales
 * 
 */

import MainLayout from "@layouts/MainLayout.astro";
import RequestDetail from "@components/RequestDetail.astro";
import AproveRequest from "@components/AproveRequestModal";
import type { UserRole } from "@type/roles";

import { getCookie } from "@data/cookies";
import { roleLabels } from "@config/role-labels";
import { apiRequest } from "@/utils/apiClient";

const role: UserRole = getCookie("role", Astro.cookies) as UserRole;
const userName = getCookie("username", Astro.cookies);
const buttonLabel = roleLabels[role];

export async function getStaticPaths() {
  const allRequests = await apiRequest(`/user/get-travel-requests/${getCookie("department_id", Astro.cookies)}/5`);
  return allRequests.map((req: any) => ({
    params: { id: req.request_id.toString() },
  }));
}
const { id } = Astro.params;
const request = await apiRequest(`/applicant/get-user-request/${id}`);

if (!request) {
  throw new Error(`No request found with ID ${id}`);
}
---

<MainLayout title={`Solicitud #${request.request_id}`} data={{ userName, buttonLabel, role }} >
  <RequestDetail
    request={request}
    title={`SOLICITUD #${request.request_id}`}
    subtitle="Detalles de la Solicitud a Atender"
  />
  <div class="flex justify-end gap-4 mt-8">
    <AproveRequest
      client:only="react"
      request_id={request.request_id}
      title="Confirmar envío"
      message="¿Está seguro de aprobar esta solicitud?"
      redirection="/dashboard"
      modal_type="success"
      variant="filled"
    >
      Aprobar
    </AproveRequest>
  </div>
</MainLayout>