---
/**
 * Author: Julia Maria Stephanie Duenkelsbuehler Castillo 
 * 
 * Description: Edit a specific user's information as an admin
 **/

 export const prerender = false;
import TextHeader from '@components/TextHeader.astro';
import MainLayout from "@layouts/MainLayout.astro";
import UserEditForm from "@components/UserForm.tsx"; // Form of user info 

import type { UserRole } from "@type/roles";
import { getCookie } from "@data/cookies";
import { roleLabels } from "@config/role-labels";

const role: UserRole = getCookie("role") as UserRole;
const buttonLabel = roleLabels[role];
const userName = getCookie("username");

import { apiRequest } from "@/utils/apiClient";

export async function getStaticPaths() {
  let users = [];
  try {
    users = await apiRequest(`/admin/get-all-users`);
  } catch (error) {
    users = [];
  }
  return users.map((user: any) => ({
    params: { id: user.id.toString() },
  }));
}

const { id } = Astro.params;
let user = null;
try {
  user = await apiRequest(`/admin/get-user/${id}`);
} catch (error) {
  user = null;
}
---

<MainLayout title="Editar Usuario" data={{ userName, buttonLabel, role }}>
  <div>
    <TextHeader
      title="EDITAR INFORMACIÓN DE USUARIO"
      subtitle="Por favor edite la información del usuario en el siguiente formulario"
    />
    <main class="bg-white rounded-lg shadow-md p-8">
      <UserEditForm
        client:only="react"
        data={user}
        mode='edit'
      />
    </main>
  </div>
</MainLayout>