---
import MainLayout from "@layouts/MainLayout.astro";
import AdminLayout from "@layouts/AuthLayout.astro";
import Button from '@components/Button.astro';
import viajes from '../datadummy/viajesSolicitante.json';
import solicitudes from '../datadummy/solicitudes.json';


const role = "Applicant"; // or "Authorizer

const headerData = {
	userName: "John Doe",
	userAvatar: "/profile-icon.jpg",
	showButtonLabel: role
};


const sidebarData = {
	role: role
};



const pageTitle = "Dashboard";
const isApplicant = sidebarData.role === "Applicant";
const Layout = isApplicant ? MainLayout : AdminLayout;
const cantidadSolicitudes = viajes.length;
const cantidaAutorizar = solicitudes.length;
---

<Layout 
  title={pageTitle} 
  headerData={headerData} 
  sidebarData={sidebarData}
>
  {isApplicant ? (
    <div class="flex flex-col p-12 bg-neutral-50">
      <main>
        <section class="mb-6">
          <h1 class="text-4xl font-bold">BIENVENIDO, {headerData.userName.toUpperCase()}</h1>
          <p class="text-xl font-semibold text-secondary-500">DITTA CONSULTING</p>
        </section>

        {cantidadSolicitudes > 0 ? (
          <section class="bg-white p-6 rounded-lg shadow w-full">
            <h2 class="flex text-xl font-bold mb-4">
              VIAJES EN PROCESO 
              <p class="px-2 align-middle text-primary-500">({cantidadSolicitudes})</p>
            </h2>
            <div class="grid gap-4">
              {viajes.slice(0, 3).map((viaje) => {
                const isAprobada = viaje.status === 'aprobada';
                return (
                  <div class="grid grid-cols-[2fr_2fr_1fr] gap-4 bg-gray-100 p-4 rounded shadow-sm w-full h-full">
                    <div class="col-span-2 space-y-2">
                      <p class="font-bold text-lg break-words">{viaje.numero}</p>
                      <div class="text-sm text-gray-700 grid grid-cols-[1fr_2fr] gap-y-1">
                        <p><span class="font-semibold">Lugar:</span> {viaje.lugar}</p>
                        <p><span class="font-semibold">Fechas:</span> {viaje.fechaInicio} - {viaje.fechaFin}</p>
                        <p>
                          <span class="font-semibold">Estado:</span> 
                          <span class={`ml-1 font-semibold ${isAprobada ? 'text-success-400' : 'text-warning-400'}`}>
                            {viaje.status.toUpperCase()}
                          </span>
                        </p>
                        <p><span class="font-semibold">Responsable:</span> {viaje.responsable}</p>
                      </div>
                    </div>
                    <div class="flex flex-col justify-center h-full gap-1">
                      <a href={`/editar/${viaje.numero}`}>
                        <Button 
                          color="primary" 
                          disabled={isAprobada} 
                          variant="filled" 
                          size="medium"
                          customSizeClass="w-full"
                        >
                          EDITAR
                        </Button>
                      </a>
                      <a href={`/comprobar/${viaje.numero}`}>
                        <Button 
                          color="primary" 
                          disabled={!isAprobada} 
                          variant="filled" 
                          size="medium"
                          customSizeClass="w-full"
                        >
                          COMPROBAR
                        </Button>
                      </a>
                    </div>
                  </div>
                );
              })}
            </div>
          </section>
        ) : (
          <section class="bg-gray-100 p-6 rounded-lg shadow">
            <h2 class="text-xl font-bold mb-4">VIAJES EN PROCESO</h2>
            <h3 class="text-xl font-bold mb-4 text-gray-500">NO TIENES VIAJES AGENDADOS</h3>
          </section>
        )}

        <a href="/solicitud" class="mt-8 flex justify-center">
          <Button 
            variant="filled" 
            color="secondary" 
            size="custom" 
            customSizeClass="w-128 py-3 text-base font-bold"
          >
            SOLICITA UN NUEVO VIAJE
          </Button>
        </a>
      </main>
    </div>
  ) : (
    <div class="flex flex-col p-12 bg-neutral-50 h-full">
      <main>
        <section class="mb-6">
          <h1 class="text-4xl font-bold">BIENVENIDO, {headerData.userName.toUpperCase()}</h1>
          <p class="text-xl font-semibold text-secondary-500">DITTA CONSULTING</p>
        </section>

        <section>
			<h2 class="flex text-xl font-bold mb-4">
				SOLICITUDES POR AUTORIZAR
              <p class="px-2 align-middle text-primary-500">({cantidaAutorizar})</p>
            </h2>
          {solicitudes.length > 0 ? (
            <div class="grid grid-cols-2 gap-4">
              {
                solicitudes.slice(0, 4).map((s) => (
                  <div class="bg-white rounded-lg p-4 shadow-sm border border-neutral-100">
                    <div class="flex justify-between items-center mb-2">
                      <div class="flex items-center gap-2">
                        <div class="w-10 h-10 rounded-full bg-purple-100 text-purple-700 flex items-center justify-center">
                          <span class="text-sm">ðŸ‘¤</span>
                        </div>
                        <div>
                          <p class="font-semibold">{s.nombre}</p>
                          <p class="text-xs text-gray-500">{s.puesto}</p>
                        </div>
                      </div>
                      <a href={`/detalle/${s.solicitud}`} class="text-gray-500 hover:text-gray-700 text-xl">â‹®</a>
                    </div>
                    <div class="text-sm text-gray-700 space-y-1">
                      <p><strong>#{s.solicitud}</strong></p>
                      <p>{s.fecha}</p>
                      <span class={`inline-block px-2 py-1 text-xs font-semibold rounded-full
                        ${s.estado === 'Urgente' ? 'bg-red-100 text-red-600' :
                          s.estado === 'Normal' ? 'bg-yellow-100 text-yellow-600' :
                          'bg-gray-100 text-gray-500'}`}>
                        {s.estado}
                      </span>
                    </div>
                  </div>
                ))
              }
            </div>
          ) : (
            <div class="bg-gray-100 p-6 rounded-lg shadow w-full text-center text-gray-500 font-semibold">
              NO HAY SOLICITUDES POR APROBAR
            </div>
          )}
        </section>
      </main>
    </div>
  )}
</Layout>