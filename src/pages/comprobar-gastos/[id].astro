---

/**
 * Author: José Antonio González and Kenia Esmeralda Ramos Javier
 * Description: This is the page where we separate the content that is stablished for a certain user of Account Payable team.
 * 
 */
 
import MainLayout from "@layouts/MainLayout.astro";
import ExpensesValidation from "@components/ExpensesValidation.astro";
import type { UserRole } from "@type/roles";

import { getCookie } from "@data/cookies";
import { roleLabels } from "@config/role-labels";
import { apiRequest } from '@utils/apiClient';

const role: UserRole = getCookie("role") as UserRole;
const userName = getCookie("username");
const buttonLabel = roleLabels[role];

// export async function getStaticPaths() {
//   //Status corresponding to Accounts Payable COMPROBAR GASTOS
//   const status = 6;
//   const requests = await apiRequest(`/user/get-travel-requests/${getCookie("department_id")}/${status}`);
//   return requests.map((req: any) => ({
//     params: { id: req.request_id.toString() },
//   }));
// }

// const { id } = Astro.params;
// const request = await apiRequest(`/user/get-travel-request/${id}`);

// FETCH DUMMY DATA
import expenses from "@data/get-expense-validations.json";
export async function getStaticPaths() {
  const requests = expenses
  return requests.map((req: any) => ({
    params: { id: req.request_id.toString() },
  }));
}

const { id } = Astro.params;
const request = expenses[0]


if (!request) {
  throw new Error(`No request found with ID ${id}`);
}
---

<MainLayout title={`Solicitud #${request.request_id}`} data={{ userName, buttonLabel, role }} >
  <ExpensesValidation request={request} />
</MainLayout>
