---
/**
 * Authors: José Antonio González
 * 
 * Description: This is the page where the Account Payable team can see the details of the expenses of a user
 * 
 * 
 **/

import Button from '@components/Button.astro';
import TextHeader from '@components/TextHeader.astro';
import ReceiptActions from '@components/ReceiptActions.tsx';
import { getStatusProps } from '@utils/getStatus';


const { request } = Astro.props;

//Diferent colors for the status of the request
const status_colors = {
  'Pending': 'text-warning-400',
  'Aproved': 'text-success-400',
  'Declined': 'text-danger-400',
};

// Callback function for approving or reject a receipt
function handleApprove(id: number) {
  console.log("Aprobado:", id);
}

function handleReject(id: number) {
  console.log("Rechazado:", id);
}

---
<main class="flex flex-col items-center">
  <div class="w-full flex flex-col rounded border border-gray-300 p-10">

    <div class="flex justify-between items-center">
      <TextHeader
        title={`SOLICITUD #${request.request_id}`}
        subtitle="Comprobantes de Gastos"
      
      />
      
      <h1 class=`text-m ${status_colors[request.status]} font-semibold`>{request.status}</h1>
    </div>
  <div>
    <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Comprobantes</h3>

    <div class="grid gap-4">
      <!-- We separate the "expenses" content of the object -->      
      {request.expenses.map((request: any) => {
        const { label, class: statusClass } = getStatusProps(request.expense_status);

        return (
          <div class="grid grid-cols-[2fr_2fr_1fr] gap-6">
            
            <div class="col-span-2 space-y-2 content-wrapper">
              <p class="font-bold text-lg break-words">#{request.receipt_id}</p>
              <div class="text-sm text-gray-700 grid grid-cols-[1fr_2fr] gap-y-1">
                
                <p><span class="font-semibold">Monto:</span> {request.amount}</p>
                <p><span class="font-semibold">Rubro:</span> {request.receipt_type_name}</p>
                
                <p class="flex items-center gap-2">
                  <span class="font-semibold">Status:</span>
                  <span class={`inline-block px-3 py-1 text-xs font-semibold rounded-full ${statusClass}`}>
                    {label}
                  </span>
                </p>
              </div>
            </div>
            
            <div class="flex flex-col justify-center h-full gap-3">
              <a>
                <Button color="primary" variant="filled" size="medium" customSizeClass="w-full">
                  {/* This button should download the receipt */}                    
                  Descargar Comprobante
                </Button>
                {/* Here is pending the functionality of downloading the receipt */}
              </a>

              <!-- Component with approve/reject buttons for each receipt -->
              <ReceiptActions
                client:only="react"
                receipt_id={request.receipt_id}
                expense_status={request.expense_status}
                onApprove={handleApprove}
                onReject={handleReject}
              />
            </div>
          </div>    
        );
      })}
    </div>
  </div>
  
</div>
</main>
